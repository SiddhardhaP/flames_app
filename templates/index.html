<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>FLAMES Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e1e2f 0%, #2a2a40 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .card {
            background: #2a2a40;
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            flex: 1;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,76,104,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff4c68, #ffd369);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .form-group {
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .duplicate-badge {
            display: none;
            background: rgba(255, 211, 105, 0.2);
            border: 1px solid rgba(255, 211, 105, 0.5);
            color: #ffd369;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .duplicate-badge.show {
            display: inline-block;
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px solid transparent;
            outline: none;
            background: #1e1e2f;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        input:focus {
            border-color: #ff4c68;
            box-shadow: 0 0 15px rgba(255, 76, 104, 0.3);
            transform: scale(1.02);
        }

        input::placeholder {
            color: #888;
        }

        button {
            background: linear-gradient(45deg, #ff4c68, #ff6f85);
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            width: 100%;
        }

        button:hover:not(:disabled) {
            background: linear-gradient(45deg, #ff6f85, #ff4c68);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 76, 104, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4a90e2, #5ba0f2);
            margin-top: 15px;
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #5ba0f2, #4a90e2);
        }

        /* Error Message */
        .error-message {
            background: rgba(255, 76, 104, 0.2);
            border: 2px solid #ff4c68;
            color: #ff6f85;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            animation: slideIn 0.3s ease;
            position: relative;
            z-index: 1;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Result Display */
        .result-container {
            margin-top: 30px;
            animation: fadeInUp 0.5s ease;
            position: relative;
            z-index: 1;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result {
            font-size: 28px;
            font-weight: bold;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            animation: resultPulse 0.6s ease;
        }

        @keyframes resultPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .result.F { background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(74, 144, 226, 0.1)); color: #4a90e2; }
        .result.L { background: linear-gradient(135deg, rgba(255, 76, 104, 0.3), rgba(255, 76, 104, 0.1)); color: #ff4c68; animation: heartbeat 1s ease infinite; }
        .result.A { background: linear-gradient(135deg, rgba(255, 182, 193, 0.3), rgba(255, 182, 193, 0.1)); color: #ffb6c1; }
        .result.M { background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1)); color: #ffd700; }
        .result.E { background: linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(220, 20, 60, 0.1)); color: #dc143c; }
        .result.S { background: linear-gradient(135deg, rgba(50, 205, 50, 0.3), rgba(50, 205, 50, 0.1)); color: #32cd32; }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05); }
            50% { transform: scale(1); }
            75% { transform: scale(1.05); }
        }

        .result-count {
            font-size: 16px;
            color: #888;
            margin-top: 10px;
        }

        /* Statistics Box */
        .statistics-box {
            background: #2a2a40;
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease;
        }

        .statistics-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,211,105,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .statistics-box h3 {
            margin-bottom: 20px;
            color: #ffd369;
            font-size: 1.8em;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffd369;
        }

        .stat-item.highlight {
            background: rgba(255, 211, 105, 0.2);
            border: 2px solid #ffd369;
            transform: scale(1.05);
        }

        .stat-info {
            margin-top: 20px;
            padding: 12px;
            background: rgba(255, 211, 105, 0.1);
            border-left: 3px solid #ffd369;
            border-radius: 8px;
            font-size: 12px;
            color: #ccc;
            text-align: left;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        .stat-info strong {
            color: #ffd369;
        }

        /* History Box */
        .history-box {
            background: #2a2a40;
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease;
        }

        .history-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74,144,226,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        .history-box h3 {
            margin-bottom: 20px;
            color: #4a90e2;
            font-size: 1.8em;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .history-list {
            max-height: 500px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .history-item-content {
            flex: 1;
            min-width: 0;
        }

        .history-names {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }

        .history-result {
            font-size: 14px;
            color: #aaa;
        }

        .history-menu-btn {
            background: transparent;
            border: none;
            color: #aaa;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            opacity: 0.6;
            position: relative;
            line-height: 1;
        }

        .history-menu-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            opacity: 1;
            color: white;
        }

        .history-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background: #2a2a3e;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 140px;
            z-index: 1000;
            display: none;
            overflow: hidden;
            animation: fadeIn 0.2s ease;
        }

        .history-menu-dropdown.show {
            display: block;
        }

        .history-menu-item {
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .history-menu-item.delete {
            color: #ff6f85;
        }

        .history-menu-item.delete:hover {
            background: rgba(255, 76, 104, 0.2);
        }

        .history-menu-item.recalculate {
            color: #4da6ff;
        }

        .history-menu-item.recalculate:hover {
            background: rgba(77, 166, 255, 0.2);
        }

        .history-empty {
            text-align: center;
            color: #888;
            padding: 30px 0;
            font-style: italic;
        }

        .clear-history-btn {
            background: rgba(255, 76, 104, 0.2);
            border: 1px solid #ff4c68;
            color: #ff6f85;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            background: rgba(255, 76, 104, 0.3);
        }

        /* Responsive */
        @media (max-width: 968px) {
            body {
                padding: 15px;
            }

            .container {
                flex-direction: column;
                gap: 15px;
            }

            .card, .statistics-box, .history-box {
                max-width: 100%;
            }

            .statistics-box, .history-box {
                max-width: 100%;
            }

            .stat-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                gap: 15px;
            }

            .card, .statistics-box, .history-box {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2em;
                margin-bottom: 25px;
            }

            .statistics-box h3 {
                font-size: 1.6em;
            }

            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-item {
                padding: 15px;
            }

            .stat-value {
                font-size: 24px;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .container {
                gap: 15px;
            }

            .card, .statistics-box, .history-box {
                padding: 25px 15px;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .form-group {
                margin: 12px 0;
            }

            input {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
                margin: 8px 0;
            }

            button {
                padding: 14px 25px;
                font-size: 16px;
                margin-top: 15px;
            }

            .statistics-box h3 {
                font-size: 1.4em;
                margin-bottom: 15px;
            }

            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-item {
                padding: 12px;
            }

            .stat-label {
                font-size: 12px;
            }

            .stat-value {
                font-size: 22px;
            }

            .result {
                font-size: 22px;
                padding: 15px;
            }

            .result-count {
                font-size: 14px;
            }

            .stat-info {
                font-size: 11px;
                padding: 10px;
            }
        }

        @media (max-width: 400px) {
            body {
                padding: 8px;
            }

            .card, .statistics-box, .history-box {
                padding: 20px 12px;
            }

            h1 {
                font-size: 1.6em;
                margin-bottom: 18px;
            }

            input {
                padding: 10px;
                font-size: 16px;
            }

            button {
                padding: 12px 20px;
                font-size: 15px;
            }

            .statistics-box h3 {
                font-size: 1.3em;
            }

            .stat-grid {
                gap: 8px;
            }

            .stat-item {
                padding: 10px;
            }

            .stat-value {
                font-size: 20px;
            }

            .result {
                font-size: 20px;
                padding: 12px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            button {
                min-height: 44px; /* iOS touch target minimum */
            }

            input {
                min-height: 44px; /* iOS touch target minimum */
            }

            .stat-item {
                min-height: 60px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Left Box: Form and Results -->
    <div class="card">
        <h1>üî• FLAMES Game üî•</h1>

        <form id="flamesForm" action="/calculate" method="post">
            <div class="form-group">
                <input type="text" name="name1" id="name1" placeholder="Enter first name" 
                       value="{{ name1 if name1 else '' }}" required>
            </div>
            <div class="form-group">
                <input type="text" name="name2" id="name2" placeholder="Enter second name" 
                       value="{{ name2 if name2 else '' }}" required>
            </div>
            <div class="duplicate-badge" id="duplicateBadge">
                ‚úì Already calculated
            </div>
            <button type="submit" id="submitBtn">Check Relationship</button>
        </form>

        <!-- Error Message -->
        {% if error %}
        <div class="error-message">
            ‚ö†Ô∏è {{ error }}
        </div>
        {% endif %}

        <!-- Result Display -->
        {% if result %}
        <div class="result-container">
            <div class="result {{ result.result_type if result.result_type else '' }}">
                {{ result.result }}
            </div>
            {% if result.count %}
            <div class="result-count">
                Remaining letters: {{ result.count }}
            </div>
            {% endif %}
            <button type="button" class="btn-secondary" id="calculateNextBtn" onclick="clearForm()">
                Calculate Next Relationship
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Right Box: Statistics or History -->
    {% if result and result.statistics %}
    <div class="statistics-box" id="statisticsBox">
        <h3>üìä FLAMES Statistics</h3>
        <div class="stat-grid">
            {% for letter, percentage in result.statistics.items() %}
            <div class="stat-item {% if result.result_type == letter %}highlight{% endif %}">
                <div class="stat-label">
                    {% if letter == 'F' %}Friends
                    {% elif letter == 'L' %}Love
                    {% elif letter == 'A' %}Affection
                    {% elif letter == 'M' %}Marriage
                    {% elif letter == 'E' %}Enemies
                    {% elif letter == 'S' %}Siblings
                    {% endif %}
                </div>
                <div class="stat-value">{{ percentage }}%</div>
            </div>
            {% endfor %}
        </div>
        <div class="stat-info">
            <strong>üí° How it works:</strong> Percentages show how often each result appears when testing 100 different letter counts. The highlighted box is your actual result.
        </div>
    </div>
    {% endif %}
    
    <div class="history-box" id="historyBox" {% if result and result.statistics %}style="display: none;"{% endif %}>
        <h3>üìú Calculation History</h3>
        <div class="history-list" id="historyList">
            <div class="history-empty">No calculations yet. Start calculating to see history!</div>
        </div>
        <button type="button" class="clear-history-btn" onclick="clearHistory()" id="clearHistoryBtn" style="display: none;">
            Clear History
        </button>
    </div>
</div>

<script>
    // Load history from localStorage
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('flamesHistory') || '[]');
        const historyList = document.getElementById('historyList');
        const clearBtn = document.getElementById('clearHistoryBtn');
        
        if (history.length === 0) {
            historyList.innerHTML = '<div class="history-empty">No calculations yet. Start calculating to see history!</div>';
            clearBtn.style.display = 'none';
        } else {
            historyList.innerHTML = '';
            history.forEach(function(item, index) {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'history-item-content';
                contentDiv.innerHTML = `
                    <div class="history-names">${item.name1} & ${item.name2}</div>
                    <div class="history-result">${item.result}</div>
                `;
                
                // Create menu button container
                const menuContainer = document.createElement('div');
                menuContainer.className = 'history-menu-container';
                menuContainer.style.position = 'relative';
                
                const menuBtn = document.createElement('button');
                menuBtn.className = 'history-menu-btn';
                menuBtn.innerHTML = '‚ãØ';
                menuBtn.title = 'More options';
                
                const dropdown = document.createElement('div');
                dropdown.className = 'history-menu-dropdown';
                
                const recalculateOption = document.createElement('div');
                recalculateOption.className = 'history-menu-item recalculate';
                recalculateOption.innerHTML = 'üîÑ Recalculate';
                recalculateOption.onclick = function(e) {
                    e.stopPropagation();
                    document.getElementById('name1').value = item.name1;
                    document.getElementById('name2').value = item.name2;
                    document.getElementById('flamesForm').submit();
                };
                
                const deleteOption = document.createElement('div');
                deleteOption.className = 'history-menu-item delete';
                deleteOption.innerHTML = 'üóëÔ∏è Delete';
                deleteOption.onclick = function(e) {
                    e.stopPropagation();
                    deleteHistoryItem(index);
                    closeAllDropdowns();
                };
                
                dropdown.appendChild(recalculateOption);
                dropdown.appendChild(deleteOption);
                menuContainer.appendChild(menuBtn);
                menuContainer.appendChild(dropdown);
                
                // Toggle dropdown on menu button click
                menuBtn.onclick = function(e) {
                    e.stopPropagation();
                    // Close all other dropdowns
                    closeAllDropdowns();
                    // Toggle this dropdown
                    dropdown.classList.toggle('show');
                };
                
                historyItem.appendChild(contentDiv);
                historyItem.appendChild(menuContainer);
                
                historyItem.onclick = function(e) {
                    // Don't trigger if clicking on menu button or dropdown
                    if (menuContainer.contains(e.target)) {
                        return;
                    }
                    document.getElementById('name1').value = item.name1;
                    document.getElementById('name2').value = item.name2;
                    document.getElementById('flamesForm').submit();
                };
                
                historyList.appendChild(historyItem);
            });
            clearBtn.style.display = 'block';
        }
    }

    // Save calculation to history
    function saveToHistory(name1, name2, result) {
        const history = JSON.parse(localStorage.getItem('flamesHistory') || '[]');
        const newEntry = {
            name1: name1,
            name2: name2,
            result: result,
            timestamp: new Date().toISOString()
        };
        
        // Add to beginning of array
        history.unshift(newEntry);
        
        // Keep only last 10 calculations
        if (history.length > 10) {
            history.pop();
        }
        
        localStorage.setItem('flamesHistory', JSON.stringify(history));
    }

    // Close all dropdown menus
    function closeAllDropdowns() {
        const dropdowns = document.querySelectorAll('.history-menu-dropdown');
        dropdowns.forEach(function(dropdown) {
            dropdown.classList.remove('show');
        });
    }

    // Delete a specific history item
    function deleteHistoryItem(index) {
        const history = JSON.parse(localStorage.getItem('flamesHistory') || '[]');
        if (index >= 0 && index < history.length) {
            history.splice(index, 1);
            localStorage.setItem('flamesHistory', JSON.stringify(history));
            loadHistory();
            checkDuplicate();
        }
    }

    // Clear history
    function clearHistory() {
        if (confirm('Are you sure you want to clear all history?')) {
            localStorage.removeItem('flamesHistory');
            loadHistory();
            checkDuplicate();
        }
    }

    // Check if current names already exist in history
    function checkDuplicate() {
        const name1 = document.getElementById('name1').value.trim().toLowerCase();
        const name2 = document.getElementById('name2').value.trim().toLowerCase();
        const badge = document.getElementById('duplicateBadge');
        
        if (!name1 || !name2) {
            badge.classList.remove('show');
            return;
        }
        
        const history = JSON.parse(localStorage.getItem('flamesHistory') || '[]');
        const isDuplicate = history.some(function(item) {
            const itemName1 = item.name1.toLowerCase().trim();
            const itemName2 = item.name2.toLowerCase().trim();
            // Check both orders (name1-name2 and name2-name1)
            return (itemName1 === name1 && itemName2 === name2) || 
                   (itemName1 === name2 && itemName2 === name1);
        });
        
        if (isDuplicate) {
            badge.classList.add('show');
        } else {
            badge.classList.remove('show');
        }
    }

    // Function to clear form and start new calculation
    function clearForm() {
        document.getElementById('name1').value = '';
        document.getElementById('name2').value = '';
        
        // Hide duplicate badge
        document.getElementById('duplicateBadge').classList.remove('show');
        
        // Hide statistics box and show history box
        const statsBox = document.getElementById('statisticsBox');
        const historyBox = document.getElementById('historyBox');
        const resultContainer = document.querySelector('.result-container');
        
        if (statsBox) {
            statsBox.style.display = 'none';
        }
        if (historyBox) {
            historyBox.style.display = 'block';
            loadHistory();
        }
        if (resultContainer) {
            resultContainer.style.display = 'none';
        }
        
        // Scroll to top to show the form
        window.scrollTo({ top: 0, behavior: 'smooth' });
        // Focus on first input for better UX
        setTimeout(function() {
            document.getElementById('name1').focus();
        }, 300);
    }

    // Add event listeners for input changes to check duplicates
    document.addEventListener('DOMContentLoaded', function() {
        const name1Input = document.getElementById('name1');
        const name2Input = document.getElementById('name2');
        
        name1Input.addEventListener('input', checkDuplicate);
        name2Input.addEventListener('input', checkDuplicate);
        
        // Check on page load if names are pre-filled
        setTimeout(checkDuplicate, 100);
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.history-menu-container')) {
                closeAllDropdowns();
            }
        });
    });

    // Save current result to history when page loads with result
    {% if result %}
    window.addEventListener('load', function() {
        const name1 = '{{ name1 }}';
        const name2 = '{{ name2 }}';
        const result = '{{ result.result }}';
        if (name1 && name2 && result) {
            saveToHistory(name1, name2, result);
        }
        // Check for duplicate after saving
        setTimeout(checkDuplicate, 200);
    });
    {% else %}
    // Load history when page loads without result
    window.addEventListener('load', function() {
        loadHistory();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        // Check for duplicate on page load
        setTimeout(checkDuplicate, 200);
    });
    {% endif %}
</script>

</body>
</html>
